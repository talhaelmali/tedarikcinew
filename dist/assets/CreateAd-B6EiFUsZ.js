import{r as i,u as V,o as _,j as e,g as G,M as W,D as k,F as v,h as f,i as w,S as b,a as J,b as X,c as Y,N as Z,O as ee,k as ae}from"./index-Pf0wcubd.js";import{S as B}from"./react-select.esm-CCToMdqW.js";const j=G(),te=W();function re(){const[m,S]=i.useState(null),[d,U]=i.useState(null),[A,I]=i.useState(!0),[E,O]=i.useState([]),[u,D]=i.useState([]),[p,T]=i.useState([]),z=V(),[se,L]=i.useState(""),[s,g]=i.useState({title:"",content:"",sectors:[],dueDate:"",duration:"3",paymentMethod:"",maxBid:"",requestSample:!1,adType:"",quantity:"",unit:""});i.useEffect(()=>{const t=_(ae,a=>{S(a||null)});return()=>t()},[]),i.useEffect(()=>{(async()=>{if(m){const a=k(f(j,"companies"),v("adminUserId","==",m.uid)),n=await w(a);let l=null,r=null;if(n.forEach(o=>{l=o.data(),r=o.id}),!l){const o=k(f(j,"companies"),v("Users","array-contains",m.uid));(await w(o)).forEach(y=>{l=y.data(),r=y.id})}l&&U({...l,id:r});const h=k(f(j,"sectors"),v("type","==","Alt Sektör")),x=(await w(h)).docs.map(o=>({value:o.data().name,label:o.data().name}));O(x),I(!1)}})()},[m]);const M=t=>t.replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,"."),C=t=>{const{name:a,value:n}=t.target;g({...s,[a]:M(n)})},c=t=>{const{name:a,value:n,type:l,checked:r,files:h}=t.target;l==="file"?P(h):g({...s,[a]:l==="checkbox"?r:n})},P=t=>{const a=Array.from(t).slice(0,5-u.length),n=a.map(l=>URL.createObjectURL(l));D([...u,...n]),T([...p,...a])},K=t=>{const a=u.filter((l,r)=>r!==t),n=p.filter((l,r)=>r!==t);D(a),T(n)},R=t=>{g({...s,sectors:t.map(a=>a.value)})},$=t=>{g({...s,unit:t.value})},H=async t=>{if(t.preventDefault(),!s.adType){L("Lütfen bir teklif tipi seçiniz."),b.fire({icon:"error",title:"Hata",text:"Lütfen bir teklif tipi seçiniz."});return}if(!d||!d.isBuyer||d.isBuyerConfirmed!=="yes"){b.fire({icon:"error",title:"Erişim Engellendi",text:"İlan oluşturabilmek için alıcı olarak onaylanmış olmalısınız."});return}try{const a=new Date(s.dueDate);a.setHours(0,0,0,0);let n=[];p.length>0&&(n=await Promise.all(p.map(async(N,y)=>{const F=J(te,`ads/${m.uid}/${y}-${N.name}`);return await X(F,N),await Y(F)})));const l=s.maxBid.replace(/[.]/g,""),r=s.quantity.replace(/[.]/g,""),h=new Date,q=parseInt(s.duration),x=new Date(h);x.setDate(x.getDate()+q);const o={...s,maxBid:l,quantity:r,images:n,userId:m.uid,companyId:d.id,dueDate:a,createdAt:Z(),endDate:x};await ee(f(j,"companies",d.id,"ads"),o),b.fire({icon:"success",title:"Başarılı",text:"İlan başarıyla oluşturuldu."}).then(()=>{z("/dashboard")})}catch(a){b.fire({icon:"error",title:"Hata",text:"İlan oluşturulurken bir hata oluştu: "+a.message})}};if(A)return e.jsx("div",{children:"Loading..."});if(!d||!d.isBuyer||d.isBuyerConfirmed!=="yes")return e.jsx("div",{children:"İlan oluşturmak için alıcı olarak onaylanmış olmalısınız."});const Q=[{value:"Adet",label:"Adet"},{value:"Kilo",label:"Kilo"},{value:"Paket",label:"Paket"}];return e.jsxs("div",{className:"max-w-4xl mx-auto mb-20",children:[e.jsx("h2",{className:"text-lg font-medium leading-6 text-gray-900",children:"İlan Detayları"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Oluşturmak istediğiniz ilanın detaylarını giriniz."}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-y-6 sm:grid-cols-4 sm:gap-x-6",children:[e.jsxs("div",{className:"sm:col-span-4 grid grid-cols-1 sm:gap-x-6 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"İlan Başlığı"}),e.jsx("input",{type:"text",name:"title",id:"title",value:s.title,onChange:c,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700",children:"İlan İçeriği"}),e.jsx("textarea",{name:"content",id:"content",value:s.content,onChange:c,rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{htmlFor:"images",className:"block text-sm font-medium text-gray-700",children:"Görseller (Maksimum 5 adet)"}),e.jsxs("div",{className:"mt-1 flex justify-center rounded-md border-2 border-dashed border-gray-300 px-6 pt-5 pb-6",children:[e.jsx("input",{type:"file",name:"images",id:"images",accept:"image/*",multiple:!0,onChange:c,className:"hidden"}),e.jsx("label",{htmlFor:"images",className:"cursor-pointer",children:e.jsx("span",{children:"Birden fazla dosya yükleyin veya sürükleyin"})})]}),u.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2",children:u.map((t,a)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:`Uploaded ${a}`,className:"w-full h-auto rounded-md"}),e.jsx("button",{type:"button",onClick:()=>K(a),className:"absolute top-0 right-0 bg-red-600 text-white p-1 rounded-full",children:"×"})]},a))})]})]}),e.jsxs("div",{className:"sm:col-span-4",children:[e.jsx("label",{htmlFor:"sectors",className:"block text-sm font-medium text-gray-700",children:"Sektör Seçimi"}),e.jsx(B,{isMulti:!0,name:"sectors",options:E,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",classNamePrefix:"select",required:!0,onChange:R})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700",children:"Termin Tarihi"}),e.jsx("input",{type:"date",name:"dueDate",id:"dueDate",min:new Date().toISOString().split("T")[0],value:s.dueDate,onChange:c,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{htmlFor:"duration",className:"block text-sm font-medium text-gray-700",children:"İlan Süresi"}),e.jsxs("select",{name:"duration",id:"duration",value:s.duration,onChange:c,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"3",children:"3 gün"}),e.jsx("option",{value:"7",children:"7 gün"}),e.jsx("option",{value:"15",children:"15 gün"}),e.jsx("option",{value:"30",children:"30 gün"})]})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{htmlFor:"maxBid",className:"block text-sm font-medium text-gray-700",children:"Max Fiyat Teklifi (Opsiyonel)"}),e.jsx("input",{type:"text",name:"maxBid",id:"maxBid",value:s.maxBid,onChange:C,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-700",children:"Adet"}),e.jsx("input",{type:"text",name:"quantity",id:"quantity",required:!0,value:s.quantity,onChange:C,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{htmlFor:"unit",className:"block text-sm font-medium text-gray-700",children:"Birim"}),e.jsx(B,{name:"unit",options:Q,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",classNamePrefix:"select",onChange:$})]}),e.jsx("div",{className:"sm:col-span-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"requestSample",name:"requestSample",type:"checkbox",checked:s.requestSample,onChange:c,className:"h-4 w-4 text-sky-600 border-gray-300 rounded"})}),e.jsx("div",{className:"ml-3 text-sm",children:e.jsx("label",{htmlFor:"requestSample",className:"font-medium text-gray-700",children:"Numune talep ediyorum."})})]})}),e.jsxs("div",{className:"sm:col-span-4",children:[e.jsx("label",{htmlFor:"adType",className:"block text-sm font-medium text-gray-700",children:"Teklif Tipi Seç"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"adType1",name:"adType",type:"radio",value:"Kapalı Usül Teklif",checked:s.adType==="Kapalı Usül Teklif",onChange:c,className:"h-4 w-4 text-sky-600 border-gray-300"}),e.jsx("label",{htmlFor:"adType1",className:"ml-3 block text-sm font-medium text-gray-700",children:"Kapalı Usül Teklif"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"adType2",name:"adType",type:"radio",value:"Açık Usül Teklif",checked:s.adType==="Açık Usül Teklif",onChange:c,className:"h-4 w-4 text-sky-600 border-gray-300"}),e.jsx("label",{htmlFor:"adType2",className:"ml-3 block text-sm font-medium text-gray-700",children:"Açık Usül Teklif"})]})]})]})]}),e.jsx("div",{className:"mt-6 text-right",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-sky-500",children:"Oluştur"})})]})]})}export{re as default};
