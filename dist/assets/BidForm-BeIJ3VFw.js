import{g as Y,B as $,r,u as G,k as P,j as e,f as z,d as D,i as h,h as f,D as b,F as g,S as k,O as J}from"./index-Pf0wcubd.js";const m=Y(),X=()=>{const{companyId:x,adId:y}=$(),[o,N]=r.useState(null),[K,F]=r.useState(null),[t,I]=r.useState(null),[B,U]=r.useState(""),[j,L]=r.useState(""),[S,Q]=r.useState(""),[v,q]=r.useState([]),[w,H]=r.useState(!1),[M,O]=r.useState(!0),R=G();r.useEffect(()=>{const s=P.onAuthStateChanged(a=>{N(a||null)});return()=>s()},[]),r.useEffect(()=>{(async()=>{try{const a=await z(D(m,"companies",x,"ads",y));a.exists()&&I(a.data());const l=await z(D(m,"companies",x));l.exists()&&F(l.data());const p=(await h(f(m,"companies",x,"ads",y,"bids"))).docs.map(i=>({id:i.id,...i.data()}));q(p);const n=b(f(m,"companies"),g("adminUserId","==",o==null?void 0:o.uid)),d=await h(n);let c=null;if(d.forEach(i=>{c=i.data(),c.id=i.id}),!c){const i=b(f(m,"companies"),g("Users","array-contains",o==null?void 0:o.uid));(await h(i)).forEach(C=>{c=C.data(),c.id=C.id})}c&&p.find(E=>E.bidderCompanyId===c.id)&&H(!0)}catch(a){console.error("Error fetching data:",a)}O(!1)})()},[x,y,o]);const T=s=>s.length>0?Math.min(...s.map(a=>parseFloat(a.bidAmount))):null,V=async s=>{s.preventDefault();const a=parseFloat(B);let l=null;if((t==null?void 0:t.adType)==="Açık Usül İhale"){const u=T(v);l=u!==null?u:t==null?void 0:t.maxBid}else l=t==null?void 0:t.maxBid;if(l!==null&&(a>=l||a===l)){k.fire({title:"Hata!",text:"Verdiğiniz teklif maksimum teklif ile aynı veya daha fazla olamaz. En az 1 düşük teklif vermelisiniz.",icon:"error",confirmButtonText:"Tamam"});return}if(!w&&!j){k.fire({title:"Hata!",text:"İlk teklif için detay girmelisiniz.",icon:"error",confirmButtonText:"Tamam"});return}try{const u=b(f(m,"companies"),g("adminUserId","==",o.uid)),p=await h(u);let n=null;if(p.forEach(d=>{n=d.data(),n.id=d.id}),!n){const d=b(f(m,"companies"),g("Users","array-contains",o.uid));(await h(d)).forEach(i=>{n=i.data(),n.id=i.id})}if(n){const d={bidderCompanyId:n.id,bidderCompanyName:n.companyName,bidAmount:a,bidDetails:w?S:j,createdAt:new Date};await J(f(m,"companies",x,"ads",y,"bids"),d),k.fire({title:"Başarılı!",text:"Teklifiniz başarıyla gönderildi.",icon:"success",confirmButtonText:"Tamam"}).then(()=>{R(`/ad-details/${x}/${y}`)})}else console.log("User company does not exist")}catch(u){console.error("Error adding document:",u),k.fire({title:"Hata!",text:"Teklif gönderilirken bir hata oluştu.",icon:"error",confirmButtonText:"Tamam"})}};if(M)return e.jsx("div",{children:"Loading..."});const A=(t==null?void 0:t.adType)==="Açık Usül İhale"&&T(v)||(t==null?void 0:t.maxBid);return e.jsx("div",{className:"max-w-4xl mx-auto mb-20",children:e.jsxs("div",{className:"bg-white rounded-lg px-4 py-5 sm:px-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:[t==null?void 0:t.title," Fiyat Teklifi"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Lütfen teklifinizi ve detayları aşağıda belirtin."}),e.jsxs("form",{onSubmit:V,className:"mt-6",children:[e.jsx("div",{className:"mb-4",children:w?e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Yeni Detay (Opsiyonel)"}),e.jsx("textarea",{value:S,onChange:s=>Q(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm",placeholder:"Ek detaylar opsiyoneldir."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Daha önce teklif verdiniz, detay girmek opsiyoneldir."})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"İlk Teklif Detayları"}),e.jsx("textarea",{value:j,onChange:s=>L(s.target.value),rows:"4",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm",placeholder:"Detaylar zorunludur.",required:!0})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Teklif Tutarı"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm",children:"₺"}),e.jsx("input",{type:"number",value:B,onChange:s=>U(s.target.value),className:"mt-1 block w-full rounded-none rounded-r-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm",required:!0}),e.jsx("span",{className:"inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm",children:"TRY"})]}),A!==null&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Maksimum Teklif: ₺",A]})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2",children:"Gönder"})})]})]})})};export{X as default};
