import{r as d,G as Z,j as e,g as ge,l as ye,B as je,u as be,o as we,d as b,J as Ne,h as $,i as J,f as H,S as h,O as ve,P as K,C as Q,Q as ke,T as Ae}from"./index-Pf0wcubd.js";import{d as w,r as Ce,a as Fe}from"./duration-CjPxDxgc.js";import{M as X}from"./index-eQKlA1cn.js";import{E as Be}from"./EditAdModal-CoNATmG0.js";import{F as Se}from"./StarIcon-Cw7Vks69.js";import"./react-select.esm-CCToMdqW.js";function Te({title:n,titleId:i,...c},s){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":i},c),n?d.createElement("title",{id:i},n):null,d.createElement("path",{fillRule:"evenodd",d:"M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z",clipRule:"evenodd"}))}const z=d.forwardRef(Te),Ee=({bids:n,bidderRatings:i,handleAcceptBid:c,isUserAdmin:s,adData:N,maskCompanyName:A,handleBidClick:D,isUserAdminOrMember:C})=>{const{company:v}=Z(),j=a=>{const E=Math.floor(a),F=a%1!==0,R=5-E-(F?1:0);return e.jsxs("div",{className:"flex",children:[[...Array(E)].map((L,B)=>e.jsx(z,{className:"h-5 w-5 text-yellow-500"},B)),F&&e.jsx(z,{className:"h-5 w-5 text-gray-300"},"half-star"),[...Array(R)].map((L,B)=>e.jsx(z,{className:"h-5 w-5 text-gray-300"},B))]})},o=n.length>0?n.reduce((a,m)=>m.bidAmount<a.bidAmount?m:a,n[0]):null,T=v?n.filter(a=>a.bidderCompanyId===v.id):[];return e.jsxs("div",{className:"border-t border-gray-200 px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:N.adType==="Kapalı Usül Teklif"&&!s?"Gönderdiğim Teklifler":N.adType==="Kapalı Usül Teklif"?"Gelen Teklifler":"Gelen En Düşük Teklif"}),e.jsxs("div",{className:"mt-4",children:[N.adType==="Kapalı Usül Teklif"?s?n.length>0&&n.map(a=>e.jsxs("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:[e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:A(a.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[a.bidderCompanyId]?e.jsxs(e.Fragment,{children:[j(i[a.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[a.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:a.createdAt?new Date(a.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:a.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",a.bidAmount," ₺"]})})]})]}),s&&e.jsx("div",{className:"w-full md:w-[133px] text-[#2563EB] text-sm font-medium border-l-2 py-[17px] flex justify-center items-center",children:e.jsx("button",{className:"inline-flex justify-center rounded-md border border-transparent py-1 px-2 text-xs font-medium text-[#2563EB] hover:bg-gray-200",onClick:()=>c(a.id,a.bidderCompanyId,a.bidderCompanyName),disabled:N.status==="approved",children:"Teklifi Kabul Et"})})]},a.id)):T.length>0?T.map(a=>e.jsx("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:A(a.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[a.bidderCompanyId]?e.jsxs(e.Fragment,{children:[j(i[a.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[a.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:a.createdAt?new Date(a.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:a.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",a.bidAmount," ₺"]})})]})]})},a.id)):e.jsx("p",{className:"text-gray-500",children:"Henüz teklif vermediniz."}):o&&e.jsx("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:A(o.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[o.bidderCompanyId]?e.jsxs(e.Fragment,{children:[j(i[o.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[o.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:o.createdAt?new Date(o.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:o.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",o.bidAmount," ₺"]})})]})]})},o.id),!C&&e.jsx("div",{className:"text-right mt-4",children:e.jsx("button",{onClick:D,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Teklif Ver"})})]})]})};w.extend(Ce);w.extend(Fe);X.setAppElement("#root");const g=ge(),Ie=ye(),$e=()=>{var _;const{companyId:n,adId:i}=je(),{company:c}=Z(),[s,N]=d.useState(null),[A,D]=d.useState([]),[C,v]=d.useState(null),[j,o]=d.useState({}),[T,a]=d.useState(!0),[m,E]=d.useState(null),[F,R]=d.useState(!1),[L,B]=d.useState(!1),[S,P]=d.useState(null),[ee,I]=d.useState(!1),[se,q]=d.useState(!1),M=be();d.useEffect(()=>{c&&G()},[c,i]);const G=()=>{c!=null&&c.FollowedAds&&c.FollowedAds.includes(i)?I(!0):I(!1)};d.useEffect(()=>{const t=we(Ie,l=>{P(l||null)});return()=>t()},[]),d.useEffect(()=>{const t=b(g,"companies",n,"ads",i),l=Ne(t,async p=>{if(N(p.exists()?p.data():null),a(!1),p.exists()){const r=$(g,"companies",n,"ads",i,"bids"),u=(await J(r)).docs.map(k=>({id:k.id,...k.data()})),f={},U=await Y(n);f[n]=U;for(const k of u){const O=await Y(k.bidderCompanyId);f[k.bidderCompanyId]=O}D(u),o(f)}});return(async()=>{const p=b(g,"companies",n),r=await H(p);if(r.exists()&&(E({id:r.id,...r.data()}),S)){const y=r.data().adminUserId===S.uid;R(y),B(r.data().adminUserId===S.uid||(c==null?void 0:c.id)===n)}})(),G(),()=>l()},[i,n,S]);const Y=async t=>{const l=$(g,"companies",t,"ratings"),x=await J(l);if(x.empty)return null;{let p=0,r=0;return x.forEach(y=>{const u=y.data(),f=(u.communication+u.quality+u.speed)/3;p+=f,r++}),(p/r).toFixed(1)}},te=()=>{!s||s.status==="approved"||s.endDate&&w().isAfter(w(s.endDate.seconds*1e3))||M(`/ad-details/${n}/${i}/bid`)},ae=async(t,l,x)=>{if((await h.fire({title:"Teklifi kabul etmek istediğinizden emin misiniz?",icon:"warning",showCancelButton:!0,confirmButtonText:"Evet, kabul et!",cancelButtonText:"Hayır, iptal et"})).isConfirmed)try{const r=b(g,"companies",n,"ads",i,"bids",t),y=b(g,"companies",n,"ads",i),u=await H(r),f=await H(y);if(!u.exists()||!f.exists())throw new Error("Teklif veya ilan verisi bulunamadı.");const U=u.data(),O={ad:{...f.data()},bid:{...U},companyId:n,bidderCompanyId:l,orderDate:new Date};await ve($(g,"orders"),O),await K(y),await K(r),h.fire("Başarılı!","Teklif kabul edildi ve ilan kapatıldı.","success"),M("/myorders")}catch(r){h.fire("Hata!",`Teklif kabul edilirken bir hata oluştu: ${r.message}`,"error")}},le=async()=>{if((await h.fire({title:"İlanı silmek istediğinizden emin misiniz?",icon:"warning",showCancelButton:!0,confirmButtonText:"Evet, sil!",cancelButtonText:"Hayır, iptal et"})).isConfirmed)try{const l=b(g,"companies",n,"ads",i);await K(l),h.fire("Başarılı!","İlan başarıyla silindi.","success"),M("/dashboard")}catch(l){h.fire("Hata!",`İlan silinirken bir hata oluştu: ${l.message}`,"error")}},ne=async()=>{try{const t=b(g,"companies",c.id);await Q(t,{FollowedAds:ke(i)}),I(!0),h.fire({title:"Başarılı!",text:"İlan takibe alındı!",icon:"success",confirmButtonText:"Tamam"})}catch(t){console.error("Error following ad:",t),h.fire("Hata!","İlan takibe alınamadı.","error")}},ie=async()=>{try{const t=b(g,"companies",c.id);await Q(t,{FollowedAds:Ae(i)}),I(!1),h.fire({title:"Başarılı!",text:"İlan takibi kaldırıldı!",icon:"success",confirmButtonText:"Tamam"})}catch(t){console.error("Error unfollowing ad:",t),h.fire("Hata!","İlan takibi kaldırılamadı.","error")}},re=()=>{q(!0)},de=()=>{q(!1)},ce=t=>t?typeof t=="string"?e.jsx("img",{src:t,alt:"Ad Image",className:"h-24 w-24 object-cover cursor-pointer",onClick:()=>v(t)}):Array.isArray(t)?t.map((l,x)=>e.jsx("img",{src:l,alt:`Görsel ${x+1}`,className:"h-24 w-24 object-cover cursor-pointer",onClick:()=>v(l)},x)):null:e.jsx("p",{className:"text-sm text-gray-500",children:"Yüklenen fotoğraf yok."}),V=()=>v(null),W=t=>t.split(" ").map(l=>l.length>1?l[0]+"*".repeat(l.length-1):l).join(" ");if(T||!s)return e.jsx("div",{children:"Loading..."});const oe=(t,l)=>{if(!t||!l)return null;const x=new Date(t.seconds*1e3);return x.setDate(x.getDate()+parseInt(l)),x},me=t=>{if(!t)return"Bilinmiyor";const l=w(),p=w(t.seconds?t.seconds*1e3:t).diff(l);if(p<=0)return"Kapandı";const r=w.duration(p),y=Math.floor(r.asDays()),u=r.hours(),f=r.minutes();return`${y} gün ${u} saat ${f} dakika`},xe=t=>new Intl.NumberFormat("tr-TR",{minimumFractionDigits:0,maximumFractionDigits:2}).format(t),pe=oe(s==null?void 0:s.createdAt,s==null?void 0:s.duration),ue=me((s==null?void 0:s.endDate)||pe),fe=m!=null&&m.companyName?W(m.companyName):"Bilinmeyen Şirket",he=m!=null&&m.id?m.id.replace(/.(?=.{4})/g,"*"):"****";return e.jsxs("div",{className:"mx-auto mb-20 p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between rounded-lg px-4 py-5 sm:px-6",children:[e.jsxs("div",{className:"flex gap-5 md:gap-0 items-start flex-col md:flex-row",children:[e.jsx("img",{className:"h-10 w-10 rounded-full",src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/profilepic.svg?alt=media&token=b85d5d31-8627-48b9-9691-335d0d58329e",alt:"Profile"}),e.jsxs("div",{className:"md:ml-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[24px] leading-8 text-gray-900",children:fe}),e.jsxs("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:["@",he]})]}),e.jsx("div",{className:"flex align-top md:ml-5 px-3 py-1 bg-[#F3F4F6] mb-3",children:j[n]?e.jsxs("div",{className:"flex",children:[e.jsx(Se,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:j[n]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),F?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:le,className:"bg-red-500 text-white px-4 py-2 rounded-md",children:"Kaldır"}),e.jsx("button",{onClick:re,className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:"İlanı Düzenle"})]}):e.jsx("div",{className:"py-4 sm:px-6",children:ee?e.jsx("button",{onClick:ie,className:"bg-red-500 text-white px-4 py-2 rounded-md",children:"Bildirimleri Kapat"}):e.jsx("button",{onClick:ne,className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:"Bildirim Al"})})]}),e.jsx(Be,{isOpen:se,onRequestClose:de,adId:i,companyId:n,adData:s}),e.jsxs("div",{className:"mt-6 bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsx("div",{className:"px-4 pt-5 sm:px-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"flex flex-col md:flex-row gap-5",children:e.jsx("div",{children:(_=s==null?void 0:s.sectors)==null?void 0:_.map((t,l)=>e.jsx("span",{className:"text-xs bg-[#F3F4F6] font-medium rounded-md px-2",children:t},l))})}),e.jsxs("div",{className:"md:ml-auto flex flex-col md:flex-row mt-4 md:mt-0 gap-4",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:s.adType}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:s.createdAt?new Date(s.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"}),e.jsxs("span",{className:"ml-2 text-xs bg-[#FEF2F2] text-[#EF4444] px-3",children:["İlan Süresi: ",ue]})]})]})}),e.jsx("div",{className:"px-4 py-5 sm:p-0",children:e.jsxs("dl",{className:"",children:[e.jsx("div",{className:"py-2 sm:grid sm:grid-cols-3 sm:px-6",children:e.jsx("dt",{className:"text- font-medium text-[#111827] flex items-center gap-1",children:e.jsx("p",{children:(s==null?void 0:s.title)||"Başlık Bulunamadı"})})}),e.jsx("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-1 sm:gap-4 sm:px-6",children:e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:(s==null?void 0:s.content)||"İçerik Bulunamadı"})}),e.jsx("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"flex flex-wrap gap-4",children:ce(s==null?void 0:s.images)})})}),e.jsx("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Talep Edilen Adet: ",s!=null&&s.quantity?xe(s.quantity):"Bilinmiyor"," ",s!=null&&s.unit?s.unit:"Bilinmiyor"]})}),e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6",children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.requestSample?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),e.jsx("p",{className:"mr-10",children:"Numune Talep Ediliyor"})]}),e.jsxs("div",{className:"font-medium justify-self-end text-xs text-black",children:["Termin Tarihi: ",s!=null&&s.dueDate?new Date(s.dueDate.seconds*1e3).toLocaleDateString():"Bilinmiyor"]})]}),e.jsx(Ee,{bids:A,bidderRatings:j,isUserAdmin:F,adData:s,maskCompanyName:W,currentUser:S,handleBidClick:te,handleAcceptBid:ae,isUserAdminOrMember:L})]})})]}),e.jsx(X,{isOpen:!!C,onRequestClose:V,className:"fixed inset-0 flex items-center justify-center p-4 bg-black bg-opacity-75",children:e.jsxs("div",{className:"bg-white rounded-lg p-6",style:{width:"50%",height:"50%"},children:[e.jsx("img",{src:C,alt:"Detail View",className:"max-w-full max-h-full object-contain"}),e.jsxs("div",{className:"mt-4 text-right",children:[e.jsx("a",{href:C,download:!0,className:"inline-block bg-blue-500 text-white px-4 py-2 rounded-md",children:"İndir"}),e.jsx("button",{onClick:V,className:"ml-2 inline-block bg-gray-500 text-white px-4 py-2 rounded-md",children:"Kapat"})]})]})})]})};export{$e as default};
