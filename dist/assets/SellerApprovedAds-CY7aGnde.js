import{g as P,r as d,j as e,L as Q,i as b,h as E,P as _,d as q,o as H,D as u,F as n,aA as A,K as v,H as f,k as J,aB as T}from"./index-Pf0wcubd.js";import{F as W,M as X}from"./Modal-PprfkLmh.js";import{F as Y,a as Z}from"./ArrowLongRightIcon-CofthmIi.js";const z=P(),ee=({ad:t})=>{const[I,S]=d.useState(0),[N,k]=d.useState(!1);d.useEffect(()=>{(async()=>{try{const g=await b(E(z,"companies",t.companyId,"ads",t.id,"bids"));S(g.size)}catch(g){console.error("Error fetching bid count: ",g)}})()},[t.companyId,t.id]);const x=async()=>{try{await _(q(z,"companies",t.companyId,"ads",t.id)),alert("İlan başarıyla kaldırıldı")}catch(h){console.error("Error deleting ad: ",h)}},c=t.createdAt&&t.createdAt instanceof Date?t.createdAt.toLocaleDateString():"Tarih yok",w=t.adType==="Kapalı Usül Teklif"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return e.jsxs("li",{className:"py-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("div",{className:"flex items-center space-x-2",children:t.sectors.map((h,g)=>e.jsx("span",{className:"bg-gray-100 text-gray-800 text-sm font-medium px-2 py-1 rounded",children:h},g))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:e.jsx(Q,{to:`/ad-details/${t.companyId}/${t.id}`,className:"hover:underline",children:t.title})}),e.jsxs("span",{className:"text-blue-600",children:["#",t.id]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:t.content})]}),e.jsxs("div",{className:"text-right space-y-2",children:[e.jsxs("div",{className:"flex space-x-2 justify-end",children:[e.jsx("span",{className:`${w} px-2 py-1 text-xs font-medium rounded`,children:t.adType}),e.jsx("span",{className:"text-gray-500 text-xs",children:c})]}),e.jsx("button",{onClick:x,className:"bg-red-500 text-white px-4 py-2 rounded-md text-sm font-medium w-max",children:"İlanı Kaldır"}),t.status==="approved"&&e.jsxs("div",{className:"flex space-x-2 justify-end",children:[e.jsx("button",{onClick:()=>k(!0),className:"bg-gray-500 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Teslimatı Onayla"}),e.jsxs(Q,{to:`/chat/${t.companyId}_${t.approvedCompanyId}`,className:"flex items-center bg-green-600 text-white px-4 py-2 rounded-md text-sm font-medium w-max",children:[e.jsx(W,{className:"h-5 w-5 mr-2"}),"Firmayla İletişime Geç"]}),e.jsx("button",{className:"bg-blue-100 text-blue-700 px-4 py-2 rounded-md text-sm font-medium",children:"Faturayı İndir"})]})]})]}),N&&e.jsx(X,{ad:t,closeModal:()=>k(!1)})]})},y=P(),re=()=>{const[t,I]=d.useState([]),[S,N]=d.useState(null),[k,x]=d.useState(!0),[c,w]=d.useState(1),[h,g]=d.useState(0),[p]=d.useState(3),[l,L]=d.useState(""),[$,M]=d.useState(""),[D,F]=d.useState(null),[j,B]=d.useState([]);d.useEffect(()=>{const s=H(J,a=>{F(a||null)});return()=>s()},[]),d.useEffect(()=>{D&&K()},[D]),d.useEffect(()=>{j.length>0&&(U(),R())},[j,p,l]);const K=async()=>{x(!0);const s=u(E(y,"companies"),n("adminUserId","==",D.uid)),a=await b(s);let m=null;if(!a.empty)m=a.docs[0].id;else{const r=u(E(y,"companies"),n("Users","array-contains",D.uid)),o=await b(r);o.empty||(m=o.docs[0].id)}m&&B([m]),x(!1)},U=async()=>{x(!0);let s=[];for(const a of j){const m=l?u(f(y,"ads"),n("approvedCompanyId","==",a),n("title",">=",l),n("title","<=",l+""),v("title"),A(p)):u(f(y,"ads"),n("approvedCompanyId","==",a),v("createdAt","desc"),A(p)),r=await b(m);r.forEach(o=>{const i=o.data();i.createdAt&&i.createdAt.toDate&&(i.createdAt=i.createdAt.toDate()),s.push({id:o.id,...i,companyId:o.ref.parent.parent.id})}),r.docs.length>0&&N(r.docs[r.docs.length-1])}I(s),x(!1)},R=async()=>{let s=0;for(const a of j){const m=l?u(f(y,"ads"),n("approvedCompanyId","==",a),n("title",">=",l),n("title","<=",l+"")):u(f(y,"ads"),n("approvedCompanyId","==",a)),r=await b(m);s+=r.size}g(s)},O=async()=>{x(!0);let s=[];for(const a of j){const m=l?u(f(y,"ads"),n("approvedCompanyId","==",a),n("title",">=",l),n("title","<=",l+""),v("title"),T(S),A(p)):u(f(y,"ads"),n("approvedCompanyId","==",a),v("createdAt","desc"),T(S),A(p)),r=await b(m);r.forEach(o=>{const i=o.data();i.createdAt&&i.createdAt.toDate&&(i.createdAt=i.createdAt.toDate()),s.push({id:o.id,...i,companyId:o.ref.parent.parent.id})}),r.docs.length>0&&N(r.docs[r.docs.length-1])}I(s),x(!1),w(c+1)},G=async()=>{if(c===1)return;x(!0);let s=[];for(const a of j){const m=l?u(f(y,"ads"),n("approvedCompanyId","==",a),n("title",">=",l),n("title","<=",l+""),v("title"),A(c*p)):u(f(y,"ads"),n("approvedCompanyId","==",a),v("createdAt","desc"),A(c*p)),r=await b(m);r.forEach((o,i)=>{if(i>=(c-2)*p){const C=o.data();C.createdAt&&C.createdAt.toDate&&(C.createdAt=C.createdAt.toDate()),s.push({id:o.id,...C,companyId:o.ref.parent.parent.id})}}),r.docs.length>0&&N(r.docs[r.docs.length-1])}I(s),x(!1),w(c-1)},V=()=>{L($)};return k?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"max-w-4xl mx-auto mb-20",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"text",placeholder:"İlan Ara...",className:"flex-grow p-2 border border-gray-300 rounded-l-md",value:$,onChange:s=>M(s.target.value)}),e.jsx("button",{onClick:V,className:"p-2 bg-blue-600 text-white rounded-r-md",children:"Ara"})]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Kazandığınız İlanlar"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Kazandığınız ilanlar arasından seçip sürece devam edebilirsiniz."}),e.jsx("ul",{role:"list",className:"divide-y divide-gray-200 mt-4",children:t.map(s=>e.jsx(ee,{ad:s},s.id))}),e.jsxs("nav",{className:"flex items-center justify-between border-t border-gray-200 px-4 sm:px-0 mt-4",children:[e.jsx("div",{className:"-mt-px flex w-0 flex-1",children:e.jsxs("button",{onClick:G,className:`inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 ${c===1&&"opacity-50 cursor-not-allowed"}`,disabled:c===1,children:[e.jsx(Y,{className:"mr-3 h-5 w-5 text-gray-400","aria-hidden":"true"}),"Önceki"]})}),e.jsx("div",{className:"hidden md:-mt-px md:flex",children:Array.from({length:Math.ceil(h/p)},(s,a)=>e.jsx("button",{onClick:()=>w(a+1),className:`inline-flex items-center border-t-2 px-4 pt-4 text-sm font-medium ${c===a+1?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"}`,children:a+1},a))}),e.jsx("div",{className:"-mt-px flex w-0 flex-1 justify-end",children:e.jsxs("button",{onClick:O,className:`inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 ${c*p>=h&&"opacity-50 cursor-not-allowed"}`,disabled:c*p>=h,children:["Sonraki",e.jsx(Z,{className:"ml-3 h-5 w-5 text-gray-400","aria-hidden":"true"})]})})]})]})};export{re as default};
