import{B as z,u as w,r as o,l as N,o as E,j as t,g as P,S as r,d as y,C as q,f as C,D,h as U,F as A,i as F}from"./index-Pf0wcubd.js";import{S as I}from"./react-select.esm-CCToMdqW.js";const u=P();function M(){const{companyId:c}=z(),a=w(),[l,f]=o.useState([]),[h,g]=o.useState([]);o.useState("");const[B,p]=o.useState(null),x=N();o.useEffect(()=>{const e=E(x,s=>{s?(p(s),S(s)):r.fire({icon:"error",title:"Yetkisiz Giriş",text:"Giriş yapmanız gerekiyor."}).then(()=>{a("/pricing")})});return()=>e()},[c,a,x]);const S=async e=>{try{const s=e.uid,d=y(u,"companies",c),m=await C(d);if(m.exists()){const i=m.data();if(i.adminUserId!==s){r.fire({icon:"error",title:"Yetkisiz Giriş",text:"Bu şirketi düzenlemeye yetkiniz yok. Eğer bir hata olduğunu düşünüyorsanız lütfen bir destek talebi oluşturun."}).then(()=>{a("/dashboard")});return}if(i.sectors&&i.sectors.length>0){r.fire({icon:"warning",title:"Uyarı",text:"Sektör seçimi daha önce yapılmış, yeni sektör seçimi ve düzenleme için lütfen firma ayarlarına gidiniz."}).then(()=>{a("/dashboard")});return}}b()}catch(s){console.error("Error checking user permissions or existing sectors:",s),r.fire({icon:"error",title:"Hata",text:"Kontrol sırasında bir hata oluştu."}),a("/dashboard")}},b=async()=>{try{const e=D(U(u,"sectors"),A("type","==","Alt Sektör")),d=(await F(e)).docs.map(n=>n.data().name),i=[...new Set(d)].sort((n,v)=>n.localeCompare(v)).map(n=>({value:n,label:n}));g(i)}catch(e){console.error("Error fetching sectors:",e)}},k=e=>{f(e.map(s=>s.value))},j=async()=>{if(l.length===0){r.fire({icon:"warning",title:"Uyarı",text:"En az bir sektör seçmelisiniz."});return}try{const e=y(u,"companies",c);await q(e,{sectors:l}),r.fire({icon:"success",title:"Başarılı",text:"Sektörler başarıyla kaydedildi."}).then(()=>{a("/success")})}catch(e){r.fire({icon:"error",title:"Hata",text:"Sektörler kaydedilirken bir hata oluştu: "+e.message})}};return t.jsxs("div",{className:"max-w-4xl mx-auto mb-20",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-medium leading-6 text-gray-900",children:"Sektör Seç"}),t.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Firmanızın ilanlarla eşleşebilmesi için sektör seçiniz. En fazla ",t.jsx("strong",{children:"3 sektör"})," seçilebilir."]})]}),t.jsx("div",{className:"mt-6",children:t.jsxs("div",{className:"sm:col-span-4",children:[t.jsx("label",{htmlFor:"sectors",className:"block text-sm font-medium text-gray-700",children:"Sektör Seçimi"}),t.jsx(I,{isMulti:!0,name:"sectors",options:h,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm",classNamePrefix:"select",onChange:k,value:h.filter(e=>l.includes(e.value)),menuPortalTarget:document.body,menuPlacement:"auto",menuPosition:"fixed",maxMenuHeight:150,styles:{menuPortal:e=>({...e,zIndex:9999})}})]})}),t.jsx("div",{className:"mt-6 flex justify-end",children:t.jsx("button",{type:"button",onClick:j,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700",children:"Kaydet"})})]})}export{M as default};
