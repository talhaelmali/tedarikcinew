import{G as b,r as d,u as p,j as e,g as h,D as N,h as j,F as v,J as f,i as w,d as B,C as D,S}from"./index-DFtkyR6U.js";const z=i=>{const t=Math.floor((new Date-i)/1e3);return t<60?"1 dakikadan daha az":t<3600?`${Math.floor(t/60)} dakika önce`:t<86400?`${Math.floor(t/3600)} saat önce`:t<2592e3?`${Math.floor(t/86400)} gün önce`:"1 ay veya daha eski"},$=()=>{const{company:i,loading:c}=b(),[t,o]=d.useState([]),[g,x]=d.useState(!0),y=p();if(d.useEffect(()=>{!c&&i&&(async()=>{if(!i){console.log("Şirket bilgisi henüz yüklenmedi veya mevcut değil.");return}const a=h();try{console.log("Bildirimler çekiliyor..."),console.log(`Şirket ID: ${i.id}`);const n=N(j(a,"notifications"),v("companyId","==",i.id),f("read"),f("timestamp","desc")),r=await w(n);console.log(`Sorgu tamamlandı. ${r.size} adet bildirim bulundu.`);const l=r.docs.map(u=>({id:u.id,...u.data()}));o(l)}catch(n){console.error("Bildirimler çekilirken hata oluştu:",n)}finally{x(!1)}})()},[i,c]),c||g)return console.log("Yükleniyor: Şirket bilgisi veya bildirimler henüz yüklenmedi..."),e.jsx("div",{className:"text-center py-8",children:"Yükleniyor..."});const m=t.filter(s=>!s.read).length,k=async s=>{const a=h(),n=B(a,"notifications",s.id);try{await D(n,{read:!0}),o(r=>r.map(l=>l.id===s.id?{...l,read:!0}:l)),s.route?y(s.route):console.log("Bu bildirimin bir yönlendirme rotası yok.")}catch(r){console.error("Bildirim işaretlenirken hata oluştu:",r),S.fire("Hata","Bildirim işaretlenirken bir hata oluştu.","error")}};return e.jsxs("div",{className:"p-6 bg-white shadow-lg rounded-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Şirket Bildirimleri"}),m>0?e.jsxs("p",{className:"text-lg mb-4 text-red-600 font-semibold",children:[m," adet okunmamış bildiriminiz var."]}):e.jsx("p",{className:"text-lg mb-4 text-green-600 font-semibold",children:"Tüm bildirimler okundu."}),t.length===0?e.jsx("p",{className:"text-gray-600",children:"Hiç bildirim yok."}):e.jsx("ul",{className:"space-y-4",children:t.map(s=>{var a;return e.jsxs("li",{onClick:()=>k(s),className:"flex items-center justify-between bg-gray-50 p-4 rounded-lg shadow-sm border hover:bg-gray-100 transition cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:s.message}),e.jsx("span",{className:"text-sm text-gray-500",children:z(new Date(((a=s.timestamp)==null?void 0:a.seconds)*1e3))})]}),e.jsx("div",{className:"ml-4 text-sm text-gray-500",children:s.read?e.jsx("span",{className:"text-green-600",children:"Okundu"}):e.jsx("span",{className:"text-red-600",children:"Okunmadı"})})]},s.id)})})]})};export{$ as default};
