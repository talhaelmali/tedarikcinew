import{r as s,j as e,d as D,I as k,f as K,S as c,C as $,O as _,h as H,L as q,g as Q,G as V,D as P,J as z,F as M,i as J}from"./index-D8FzNVl7.js";import{_ as X,R as Y}from"./RatingModal-GvHCTuNj.js";import{O as W}from"./OrderDetailsModal-K2FI-v7G.js";import"./index-BfQpAw_w.js";const Z=({orderId:t,companyId:A,closeModal:h})=>{const[S,p]=s.useState(""),[O,j]=s.useState(""),[a,i]=s.useState([]),[f,x]=s.useState("pending"),[g,y]=s.useState(!1),[L,I]=s.useState({speed:0,communication:0,quality:0}),[w,v]=s.useState(!1),[b,C]=s.useState(null),[N,o]=s.useState("");s.useEffect(()=>{(async()=>{try{const n=D(k,"orders",t),u=await K(n);if(u.exists()){const R=u.data().bid;R&&R.bidderCompanyId?o(R.bidderCompanyId):c.fire("Hata!","Bid verisi veya bidderCompanyId bulunamadı.","error");const U=D(k,"orders",t,"logistics",t),E=await K(U);if(E.exists()){const B=E.data();p(B.logisticsCompany||""),j(B.trackingCode||""),i(B.images||[]),x(B.status||"pending")}else c.fire("Hata!","Lojistik verisi bulunamadı.","error")}else c.fire("Hata!","Sipariş verisi bulunamadı.","error")}catch(n){console.error("Error fetching logistics data:",n),c.fire("Hata!","Lojistik verisi alınırken bir hata oluştu.","error")}})()},[t]);const l=async()=>{if((await c.fire({title:"Teslimatı onaylamak istediğinizden emin misiniz?",icon:"warning",showCancelButton:!0,confirmButtonText:"Evet, onayla!",cancelButtonText:"Hayır, iptal et"})).isConfirmed)try{v(!0),await $(D(k,"orders",t,"logistics",t),{isApproved:!0,status:"accepted",updatedAt:new Date}),x("accepted"),v(!1),y(!0)}catch(n){console.error("Teslimat onaylanırken hata oluştu:",n),c.fire("Hata!","Teslimat onaylanırken bir hata oluştu.","error"),v(!1)}},d=(r,n)=>{I(u=>({...u,[r]:n}))},m=async()=>{if(!N){c.fire("Hata!","Geçerli bir şirket ID bulunamadı.","error");return}try{await _(H(k,"companies",N,"ratings"),L),y(!1),h(),c.fire("Başarılı!","Teslimat onaylandı ve firma puanlandı.","success"),window.location.reload()}catch(r){console.error("Değerlendirme kaydedilirken hata oluştu:",r),c.fire("Hata!","Değerlendirme kaydedilirken bir hata oluştu.","error")}},T=r=>{C(r)},F=()=>{C(null)};return e.jsxs(e.Fragment,{children:[!g&&e.jsxs("div",{className:"fixed z-10 inset-0 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Kargo / Lojistik Bilgileri"}),e.jsx("div",{className:"mt-2",children:f==="accepted"||f==="pending"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"Lojistik/Kargo Firması Adı:"})," ",S]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"Takip Kodu:"})," ",O]}),a.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4",children:a.map((r,n)=>e.jsx("img",{src:r,alt:`delivery-${n}`,className:"w-full h-auto rounded-md cursor-pointer",onClick:()=>T(r)},n))})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Kargo / Lojistik bilgileri bekleniyor..."})}),e.jsxs("div",{className:"mt-4 sm:mt-6 sm:flex sm:flex-row-reverse",children:[f==="pending"&&e.jsx("button",{onClick:l,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 sm:ml-3 sm:w-auto sm:text-sm",children:"Teslimatı Onayla"}),e.jsx("button",{onClick:h,className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-gray-700 hover:bg-gray-50 sm:mt-0 sm:w-auto sm:text-sm",children:"Kapat"})]})]})]}),b&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:b,alt:"Selected",className:"max-w-full max-h-screen object-contain"}),e.jsx("button",{onClick:F,className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2",children:"X"})]})})]}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"text-white text-lg",children:"Yükleniyor..."})}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md w-full max-w-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Firmayı Değerlendir"}),e.jsx("div",{className:"mb-4",children:["speed","communication","quality"].map(r=>e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:r==="speed"?"Hız":r==="communication"?"İletişim":"Kalite"}),e.jsx(X,{count:5,onChange:n=>d(r,n),size:24,isHalf:!0,value:L[r],emptyIcon:e.jsx("i",{className:"far fa-star"}),halfIcon:e.jsx("i",{className:"fa fa-star-half-alt"}),fullIcon:e.jsx("i",{className:"fa fa-star"}),activeColor:"#ffd700"})]},r))}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>y(!1),className:"bg-gray-300 text-black px-4 py-2 rounded-md",children:"Vazgeç"}),e.jsx("button",{onClick:m,className:"bg-blue-600 text-white px-4 py-2 rounded-md",children:"Değerlendir"})]})]})})]})},ee=({order:t})=>{const[A,h]=s.useState(!1),[S,p]=s.useState(!1),[O,j]=s.useState(!1),[a,i]=s.useState(null),[f,x]=s.useState(null);s.useState(!1);const[g,y]=s.useState(null),L=t.ad.createdAt&&t.ad.createdAt instanceof Date?t.ad.createdAt.toLocaleDateString():"Tarih yok";s.useEffect(()=>{I(),w()},[]);const I=async()=>{try{const o=D(k,"orders",t.id,"logistics",t.id),l=await K(o);l.exists()?i(l.data()):i({description:"Kargo / Lojistik bilgileri bekleniyor",status:"pending"})}catch(o){console.error("Error fetching logistics data:",o),c.fire("Hata!","Kargo / Lojistik durumu yüklenirken bir hata oluştu.","error")}},w=async()=>{try{const o=D(k,"orders",t.id),l=await K(o);l.exists()&&x(l.data().invoiceUrl)}catch(o){console.error("Error fetching invoice:",o),c.fire("Hata!","Fatura bilgisi yüklenirken bir hata oluştu.","error")}},v=async()=>{if((await c.fire({title:"Teslimatı onaylamak istediğinizden emin misiniz?",icon:"warning",showCancelButton:!0,confirmButtonText:"Evet, onayla!",cancelButtonText:"Hayır, iptal et"})).isConfirmed&&(a!=null&&a.id))try{const l=D(k,"orders",t.id,"logistics",t.id);await $(l,{isApproved:!0,status:"accepted",updatedAt:new Date}),i(d=>({...d,isApproved:!0,status:"accepted"})),c.fire("Başarılı!","Teslimat onaylandı.","success"),p(!0),h(!1)}catch(l){console.error("Teslimat onaylanırken hata oluştu:",l),c.fire("Hata!","Teslimat onaylanırken bir hata oluştu.","error")}},b=()=>a?a.status==="accepted"?e.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded overflow-hidden",children:"Kabul Edildi"}):a.status==="rejected"?e.jsx("span",{className:"bg-red-100 text-red-800 text-xs font-semibold px-2.5 py-0.5 rounded overflow-hidden",children:"Reddedildi"}):a.description==="Kargo / Lojistik bilgileri bekleniyor"?e.jsx("span",{className:"bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded overflow-hidden",children:"Kargo / Lojistik Bekleniyor"}):a.status==="pending"&&a.description!=="Kargo / Lojistik bilgileri bekleniyor"?e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded overflow-hidden",children:"Bilgiler Güncellendi"}):e.jsx("span",{className:"bg-yellow-200 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded overflow-hidden",children:"Beklemede"}):e.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs font-semibold px-2.5 py-0.5 rounded overflow-hidden",children:"Durum Bilinmiyor"}),C=()=>{j(!0)},N=()=>{j(!1)};return e.jsxs("li",{className:"py-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center bg-white p-4 rounded-lg shadow space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"flex flex-col space-y-2 w-full sm:w-auto",children:[e.jsx("div",{className:"flex items-center space-x-2 overflow-x-auto whitespace-nowrap",children:t.ad.sectors.map((o,l)=>e.jsx("span",{className:"bg-gray-100 text-gray-800 text-sm font-medium px-2 py-1 rounded max-w-[150px] overflow-hidden text-ellipsis",children:o},l))}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:t.ad.title}),e.jsxs("span",{className:"text-blue-600 text-xs",children:["#",t.id]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:t.ad.content}),e.jsxs("p",{className:"text-ml text-gray-900",children:[e.jsx("span",{className:"font-semibold",children:"Firma:"})," ",e.jsx("span",{className:"text-blue-700 font-bold",children:t.bid.bidderCompanyName})]}),e.jsxs("div",{className:"flex flex-col space-y-2 sm:flex-row sm:space-x-2 sm:space-y-0",children:[(a==null?void 0:a.description)==="Kargo / Lojistik bilgileri bekleniyor"?e.jsx("button",{disabled:!0,className:"bg-gray-300 text-gray-600 px-2 py-1 rounded-md text-xs font-medium cursor-not-allowed w-full sm:w-auto overflow-hidden text-ellipsis max-w-[150px]",children:"Kargo / Lojistik Bekleniyor"}):e.jsx("button",{onClick:()=>h(!0),className:"bg-gray-500 text-white px-2 py-1 rounded-md text-xs font-medium w-full sm:w-auto overflow-hidden text-ellipsis max-w-[150px]",children:"Kargo / Lojistik Bilgileri"}),e.jsx(q,{to:`/chat/${t.id}/${t.companyId}/${t.bid.bidderCompanyId}`,className:"flex items-center bg-green-600 text-white px-2 py-1 rounded-md text-xs font-medium w-full sm:w-auto overflow-hidden text-ellipsis max-w-[150px] leading-tight",children:"Firmayla İletişime Geç"}),f?e.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-600 text-white px-2 py-1 rounded-md text-xs font-medium w-full sm:w-auto overflow-hidden text-ellipsis max-w-[150px]",children:"Faturayı Göster"}):e.jsx("button",{disabled:!0,className:"bg-gray-300 text-gray-600 px-2 py-1 rounded-md text-xs font-medium cursor-not-allowed w-full sm:w-auto overflow-hidden text-ellipsis max-w-[150px]",children:"Fatura Bekleniyor"}),e.jsx("button",{onClick:C,className:"bg-indigo-600 text-white px-2 py-1 rounded-md text-xs font-medium w-full sm:w-auto overflow-hidden text-ellipsis max-w-[150px]",children:"Sipariş Detaylarını Görüntüle"})]})]}),e.jsx("div",{className:"text-right space-y-2 w-full sm:w-auto",children:e.jsxs("div",{className:"flex flex-col space-y-1 sm:flex-row sm:space-x-2 sm:space-y-0 justify-end",children:[e.jsx("span",{className:"text-xs overflow-hidden text-ellipsis whitespace-nowrap",children:b()}),e.jsx("span",{className:"text-gray-500 text-xs overflow-hidden text-ellipsis whitespace-nowrap",children:L})]})})]}),A&&a&&e.jsx(Z,{orderId:t.id,delivery:a,closeModal:()=>h(!1),confirmDelivery:a.description!=="Kargo / Lojistik bilgileri bekleniyor"?v:null,onImageClick:o=>y(o)}),O&&e.jsx(W,{order:t,closeModal:N}),S&&e.jsx(Y,{companyId:t.bid.bidderCompanyId,closeModal:()=>p(!1)}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:g,alt:"Large View",className:"max-w-full max-h-screen"}),e.jsx("button",{className:"absolute top-2 right-2 text-white bg-gray-800 p-2 rounded-full",onClick:()=>y(null),children:"Kapat"})]})})]})},G=Q(),le=()=>{const[t,A]=s.useState([]),[h,S]=s.useState(!0),[p,O]=s.useState(""),[j,a]=s.useState(""),[i,f]=s.useState(1),[x]=s.useState(5),[g,y]=s.useState(0),[L,I]=s.useState([]),{company:w}=V();s.useEffect(()=>{w&&v(w.id)},[w,p,i]);const v=async d=>{S(!0);const m=[],T=p?P(H(G,"orders"),M("companyId","==",d),M("ad.title",">=",p),M("ad.title","<=",p+""),z("ad.title"),z("ad.createdAt","desc")):P(H(G,"orders"),M("companyId","==",d),z("ad.createdAt","desc"));(await J(T)).forEach(n=>{const u=n.data();u.ad.createdAt&&u.ad.createdAt.toDate&&(u.ad.createdAt=u.ad.createdAt.toDate()),m.push({id:n.id,...u,companyId:d})}),m.sort((n,u)=>u.ad.createdAt-n.ad.createdAt),y(m.length),A(m.slice((i-1)*x,i*x));const r=m.slice(i*x,(i+1)*x);I(r),S(!1)},b=d=>{f(d)},C=()=>{O(j),f(1)},N=i*x,o=N-x,l=Math.ceil(g/x);return h?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"max-w-4xl mx-auto mb-20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("input",{type:"text",className:"w-full pl-4 pr-4 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:border-indigo-500",placeholder:"Sipariş Ara...",value:j,onChange:d=>a(d.target.value)}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-[#0D408F] text-white rounded-r-lg",children:"Ara"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[g," sipariş arasından ",o+1," - ",Math.min(N,g)," gösteriliyor"]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Siparişler"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Siparişlerinizin listesini görüntüleyebilirsiniz."}),e.jsx("ul",{role:"list",className:"divide-y divide-gray-200 mt-4",children:t.map(d=>e.jsx(ee,{order:d},d.id))}),l>1&&e.jsxs("nav",{className:"flex items-center justify-between border-t border-gray-200 px-4 sm:px-0 mt-4",children:[e.jsx("div",{className:"-mt-px flex w-0 flex-1",children:e.jsx("button",{onClick:()=>b(i-1),className:"inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700",disabled:i===1,children:"Önceki"})}),e.jsx("div",{className:"hidden md:-mt-px md:flex",children:Array.from({length:l},(d,m)=>e.jsx("button",{onClick:()=>b(m+1),className:`inline-flex items-center border-t-2 ${i===m+1?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"} px-4 pt-4 text-sm font-medium`,"aria-current":i===m+1?"page":void 0,children:m+1},m))}),e.jsx("div",{className:"-mt-px flex w-0 flex-1 justify-end",children:e.jsx("button",{onClick:()=>b(i+1),className:"inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700",disabled:i===l,children:"Sonraki"})})]})]})};export{le as default};
