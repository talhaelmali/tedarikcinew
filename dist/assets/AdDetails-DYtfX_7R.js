import{r as o,G as J,j as e,g as ge,l as ye,B as je,u as be,S as m,o as Ne,d as v,K as we,h as $,i as Q,f as z,O as ve,P as H,C as Z,Q as ke,T as Ae}from"./index-D8FzNVl7.js";import{d as j}from"./dayjs.min-5X-_7qHF.js";import{r as Be,d as Ce}from"./duration-3l_rJDXj.js";import{M as X}from"./index-BfQpAw_w.js";import{E as Fe}from"./EditAdModal-BeYLijlG.js";import{F as Se}from"./StarIcon-CN4wJA2O.js";import"./react-select.esm--rFHnHRR.js";function Ee({title:n,titleId:i,...r},s){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":i},r),n?o.createElement("title",{id:i},n):null,o.createElement("path",{fillRule:"evenodd",d:"M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z",clipRule:"evenodd"}))}const P=o.forwardRef(Ee),Te=({bids:n,bidderRatings:i,handleAcceptBid:r,isUserAdmin:s,adData:k,maskCompanyName:F,handleBidClick:R,isUserAdminOrMember:b})=>{const{company:A}=J(),N=a=>{const I=Math.floor(a),S=a%1!==0,L=5-I-(S?1:0);return e.jsxs("div",{className:"flex",children:[[...Array(I)].map((M,E)=>e.jsx(P,{className:"h-5 w-5 text-yellow-500"},E)),S&&e.jsx(P,{className:"h-5 w-5 text-gray-300"},"half-star"),[...Array(L)].map((M,E)=>e.jsx(P,{className:"h-5 w-5 text-gray-300"},E))]})},x=n.length>0?n.reduce((a,c)=>c.bidAmount<a.bidAmount?c:a,n[0]):null,B=A?n.filter(a=>a.bidderCompanyId===A.id):[];return e.jsxs("div",{className:"border-t border-gray-200 px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:k.adType==="Kapalı Usül Teklif"&&!b?"Gönderdiğim Teklifler":k.adType==="Kapalı Usül Teklif"?"Gelen Teklifler":"Gelen En Düşük Teklif"}),e.jsxs("div",{className:"mt-4",children:[k.adType==="Kapalı Usül Teklif"?b?n.length>0&&n.map(a=>e.jsxs("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:[e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:F(a.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[a.bidderCompanyId]?e.jsxs(e.Fragment,{children:[N(i[a.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[a.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:a.createdAt?new Date(a.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:a.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",a.bidAmount," ₺"]})})]})]}),b&&e.jsx("div",{className:"w-full md:w-[133px] text-[#2563EB] text-sm font-medium border-l-2 py-[17px] flex justify-center items-center",children:e.jsx("button",{className:"inline-flex justify-center rounded-md border border-transparent py-1 px-2 text-xs font-medium text-[#2563EB] hover:bg-gray-200",onClick:()=>r(a.id,a.bidderCompanyId,a.bidderCompanyName),disabled:k.status==="approved",children:"Teklifi Kabul Et"})})]},a.id)):B.length>0?B.map(a=>e.jsx("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:F(a.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[a.bidderCompanyId]?e.jsxs(e.Fragment,{children:[N(i[a.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[a.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:a.createdAt?new Date(a.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:a.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",a.bidAmount," ₺"]})})]})]})},a.id)):e.jsx("p",{className:"text-gray-500",children:"Henüz teklif vermediniz."}):x&&e.jsx("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:F(x.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[x.bidderCompanyId]?e.jsxs(e.Fragment,{children:[N(i[x.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[x.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:x.createdAt?new Date(x.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:x.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",x.bidAmount," ₺"]})})]})]})},x.id),!b&&e.jsx("div",{className:"text-right mt-4",children:e.jsx("button",{onClick:R,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Teklif Ver"})})]})]})};j.extend(Be);j.extend(Ce);X.setAppElement("#root");const g=ge(),Ie=ye(),ze=()=>{var _;const{companyId:n,adId:i}=je(),{company:r}=J(),[s,k]=o.useState(null),[F,R]=o.useState([]),[b,A]=o.useState(null),[N,x]=o.useState({}),[B,a]=o.useState(!0),[c,I]=o.useState(null),[S,L]=o.useState(!1),[M,E]=o.useState(!1),[T,q]=o.useState(null),[ee,D]=o.useState(!1),[se,G]=o.useState(!1),w=be();o.useEffect(()=>{r&&O()},[r,i]),o.useEffect(()=>{!B&&s&&s.endDate&&j().isAfter(j(s.endDate.seconds*1e3))&&(c==null?void 0:c.id)!==(r==null?void 0:r.id)&&m.fire({icon:"info",title:"İlan Süresi Doldu",text:"Bu ilan süresi dolduğu için artık görüntülenemiyor."}).then(()=>{w("/ads")})},[s,B,c,r,w]);const O=()=>{r!=null&&r.FollowedAds&&r.FollowedAds.includes(i)?D(!0):D(!1)};o.useEffect(()=>{const t=Ne(Ie,l=>{q(l||null)});return()=>t()},[]),o.useEffect(()=>{const t=v(g,"companies",n,"ads",i),l=we(t,async u=>{if(!u.exists()){m.fire({icon:"error",title:"İlan Bulunamadı",text:"Görüntülemek istediğiniz ilan bulunamadı."}).then(()=>{w("/ads")});return}k(u.data()),a(!1);const d=$(g,"companies",n,"ads",i,"bids"),f=(await Q(d)).docs.map(C=>({id:C.id,...C.data()})),h={},U=await Y(n);h[n]=U;for(const C of f){const K=await Y(C.bidderCompanyId);h[C.bidderCompanyId]=K}R(f),x(h)});return(async()=>{const u=v(g,"companies",n),d=await z(u);if(!d.exists()){m.fire({icon:"error",title:"Şirket Bilgisi Bulunamadı",text:"İlana ait şirket bilgisi bulunamadı."}).then(()=>{w("/ads")});return}if(I({id:d.id,...d.data()}),T){const y=d.data().adminUserId===T.uid;L(y),E(d.data().adminUserId===T.uid||(r==null?void 0:r.id)===n)}})(),O(),()=>l()},[i,n,T]);const Y=async t=>{const l=$(g,"companies",t,"ratings"),p=await Q(l);if(p.empty)return null;{let u=0,d=0;return p.forEach(y=>{const f=y.data(),h=(f.communication+f.quality+f.speed)/3;u+=h,d++}),(u/d).toFixed(1)}},te=()=>{!s||s.status==="approved"||s.endDate&&j().isAfter(j(s.endDate.seconds*1e3))||w(`/ad-details/${n}/${i}/bid`)},ae=async(t,l,p)=>{if((await m.fire({title:"Teklifi kabul etmek istediğinizden emin misiniz?",icon:"warning",showCancelButton:!0,confirmButtonText:"Evet, kabul et!",cancelButtonText:"Hayır, iptal et"})).isConfirmed)try{const d=v(g,"companies",n,"ads",i,"bids",t),y=v(g,"companies",n,"ads",i),f=await z(d),h=await z(y);if(!f.exists()||!h.exists())throw new Error("Teklif veya ilan verisi bulunamadı.");const U=f.data(),K={ad:{...h.data()},bid:{...U},companyId:n,bidderCompanyId:l,orderDate:new Date};await ve($(g,"orders"),K),await H(y),await H(d),m.fire("Başarılı!","Teklif kabul edildi ve ilan kapatıldı.","success"),w("/myorders")}catch(d){m.fire("Hata!",`Teklif kabul edilirken bir hata oluştu: ${d.message}`,"error")}},le=async()=>{if((await m.fire({title:"İlanı silmek istediğinizden emin misiniz?",icon:"warning",showCancelButton:!0,confirmButtonText:"Evet, sil!",cancelButtonText:"Hayır, iptal et"})).isConfirmed)try{const l=v(g,"companies",n,"ads",i);await H(l),m.fire("Başarılı!","İlan başarıyla silindi.","success"),w("/dashboard")}catch(l){m.fire("Hata!",`İlan silinirken bir hata oluştu: ${l.message}`,"error")}},ne=async()=>{try{const t=v(g,"companies",r.id);await Z(t,{FollowedAds:ke(i)}),D(!0),m.fire({title:"Başarılı!",text:"İlan takibe alındı!",icon:"success",confirmButtonText:"Tamam"})}catch(t){console.error("Error following ad:",t),m.fire("Hata!","İlan takibe alınamadı.","error")}},ie=async()=>{try{const t=v(g,"companies",r.id);await Z(t,{FollowedAds:Ae(i)}),D(!1),m.fire({title:"Başarılı!",text:"İlan takibi kaldırıldı!",icon:"success",confirmButtonText:"Tamam"})}catch(t){console.error("Error unfollowing ad:",t),m.fire("Hata!","İlan takibi kaldırılamadı.","error")}},re=()=>{G(!0)},de=()=>{G(!1)},oe=t=>t?typeof t=="string"?e.jsx("img",{src:t,alt:"Ad Image",className:"h-24 w-24 object-cover cursor-pointer",onClick:()=>A(t)}):Array.isArray(t)?t.map((l,p)=>e.jsx("img",{src:l,alt:`Görsel ${p+1}`,className:"h-24 w-24 object-cover cursor-pointer",onClick:()=>A(l)},p)):null:e.jsx("p",{className:"text-sm text-gray-500",children:"Yüklenen fotoğraf yok."}),V=()=>A(null),W=t=>t.split(" ").map(l=>l.length>1?l[0]+"*".repeat(l.length-1):l).join(" ");if(B||!s)return e.jsx("div",{children:"Loading..."});const ce=(t,l)=>{if(!t||!l)return null;const p=new Date(t.seconds*1e3);return p.setDate(p.getDate()+parseInt(l)),p},me=t=>{if(!t)return"Bilinmiyor";const l=j(),u=j(t.seconds?t.seconds*1e3:t).diff(l);if(u<=0)return"Kapandı";const d=j.duration(u),y=Math.floor(d.asDays()),f=d.hours(),h=d.minutes();return`${y} gün ${f} saat ${h} dakika`},xe=t=>new Intl.NumberFormat("tr-TR",{minimumFractionDigits:0,maximumFractionDigits:2}).format(t),pe=ce(s==null?void 0:s.createdAt,s==null?void 0:s.duration),ue=me((s==null?void 0:s.endDate)||pe),fe=c!=null&&c.companyName?W(c.companyName):"Bilinmeyen Şirket",he=c!=null&&c.id?c.id.replace(/.(?=.{4})/g,"*"):"****";return e.jsxs("div",{className:"mx-auto mb-20 p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between rounded-lg px-4 py-5 sm:px-6",children:[e.jsxs("div",{className:"flex gap-5 md:gap-0 items-start flex-col md:flex-row",children:[e.jsx("img",{className:"h-10 w-10 rounded-full",src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/profilepic.svg?alt=media&token=b85d5d31-8627-48b9-9691-335d0d58329e",alt:"Profile"}),e.jsxs("div",{className:"md:ml-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[24px] leading-8 text-gray-900",children:fe}),e.jsxs("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:["@",he]})]}),e.jsx("div",{className:"flex align-top md:ml-5 px-3 py-1 bg-[#F3F4F6] mb-3",children:N[n]?e.jsxs("div",{className:"flex",children:[e.jsx(Se,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:N[n]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),S?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:le,className:"bg-red-500 text-white px-4 py-2 rounded-md",children:"Kaldır"}),e.jsx("button",{onClick:re,className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:"İlanı Düzenle"})]}):e.jsx("div",{className:"py-4 sm:px-6",children:ee?e.jsx("button",{onClick:ie,className:"bg-red-500 text-white px-4 py-2 rounded-md",children:"Bildirimleri Kapat"}):e.jsx("button",{onClick:ne,className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:"Bildirim Al"})})]}),e.jsx(Fe,{isOpen:se,onRequestClose:de,adId:i,companyId:n,adData:s}),e.jsxs("div",{className:"mt-6 bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsx("div",{className:"px-4 pt-5 sm:px-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"flex flex-col md:flex-row gap-5",children:e.jsx("div",{children:(_=s==null?void 0:s.sectors)==null?void 0:_.map((t,l)=>e.jsx("span",{className:"text-xs bg-[#F3F4F6] font-medium rounded-md px-2",children:t},l))})}),e.jsxs("div",{className:"md:ml-auto flex flex-col md:flex-row mt-4 md:mt-0 gap-4",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:s.adType}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:s.createdAt?new Date(s.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"}),e.jsxs("span",{className:"ml-2 text-xs bg-[#FEF2F2] text-[#EF4444] px-3",children:["İlan Süresi: ",ue]})]})]})}),e.jsx("div",{className:"px-4 py-5 sm:p-0",children:e.jsxs("dl",{className:"",children:[e.jsx("div",{className:"py-2 sm:grid sm:grid-cols-3 sm:px-6",children:e.jsx("dt",{className:"text- font-medium text-[#111827] flex items-center gap-1",children:e.jsx("p",{children:(s==null?void 0:s.title)||"Başlık Bulunamadı"})})}),e.jsx("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-1 sm:gap-4 sm:px-6",children:e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:(s==null?void 0:s.content)||"İçerik Bulunamadı"})}),e.jsx("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"flex flex-wrap gap-4",children:oe(s==null?void 0:s.images)})})}),e.jsx("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Talep Edilen Adet: ",s!=null&&s.quantity?xe(s.quantity):"Bilinmiyor"," ",s!=null&&s.unit?s.unit:"Bilinmiyor"]})}),e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6",children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.requestSample?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),e.jsx("p",{className:"mr-10",children:"Numune Talep Ediliyor"})]}),e.jsxs("div",{className:"font-medium justify-self-end text-xs text-black",children:["Termin Tarihi: ",s!=null&&s.dueDate?new Date(s.dueDate.seconds*1e3).toLocaleDateString():"Bilinmiyor"]})]}),e.jsx(Te,{bids:F,bidderRatings:N,isUserAdmin:S,adData:s,maskCompanyName:W,currentUser:T,handleBidClick:te,handleAcceptBid:ae,isUserAdminOrMember:M})]})})]}),e.jsx(X,{isOpen:!!b,onRequestClose:V,className:"fixed inset-0 flex items-center justify-center p-4 bg-black bg-opacity-75",children:e.jsxs("div",{className:"bg-white rounded-lg p-6",style:{width:"50%",height:"50%"},children:[e.jsx("img",{src:b,alt:"Detail View",className:"max-w-full max-h-full object-contain"}),e.jsxs("div",{className:"mt-4 text-right",children:[e.jsx("a",{href:b,download:!0,className:"inline-block bg-blue-500 text-white px-4 py-2 rounded-md",children:"İndir"}),e.jsx("button",{onClick:V,className:"ml-2 inline-block bg-gray-500 text-white px-4 py-2 rounded-md",children:"Kapat"})]})]})})]})};export{ze as default};
