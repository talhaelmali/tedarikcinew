import{B as E,u as P,r as a,l as C,o as D,j as t,g as F,S as n,d as f,C as q,f as U,D as A,h as B,F as G,i as H}from"./index-Dcbjm_y_.js";import{S as I}from"./react-select.esm-Dy9iw_O8.js";const m=F();function O(){const{companyId:l}=E(),i=P(),[d,g]=a.useState([]),[u,b]=a.useState([]),[p,S]=a.useState(!0),[h,x]=a.useState(null),[M,k]=a.useState(null),y=C();a.useEffect(()=>{const e=D(y,s=>{s?(k(s),j(s)):n.fire({icon:"error",title:"Yetkisiz Giriş",text:"Giriş yapmanız gerekiyor."}).then(()=>i("/login"))});return()=>e()},[y,l,i]);const j=async e=>{try{const s=f(m,"companies",l),c=await U(s);if(c.exists()){const o=c.data();if(o.adminUserId!==e.uid){n.fire({icon:"error",title:"Yetkisiz Giriş",text:"Bu şirketi düzenlemeye yetkiniz yok. Eğer bir hata olduğunu düşünüyorsanız lütfen bir destek talebi oluşturun."}).then(()=>i("/dashboard"));return}if(o.sectors&&o.sectors.length>0){n.fire({icon:"warning",title:"Uyarı",text:"Sektör seçimi daha önce yapılmış, firma ayarlarından sektörleri güncelleyebilirsiniz."}).then(()=>i("/dashboard"));return}}w()}catch(s){console.error("Error checking user permissions or existing sectors:",s),x("Hata: Şirket verilerine erişilemiyor."),i("/dashboard")}},w=async()=>{try{const e=A(B(m,"sectors"),G("type","==","Alt Sektör")),c=(await H(e)).docs.map(r=>r.data().name),o=[...new Set(c)].sort((r,N)=>r.localeCompare(N));b(o.map(r=>({value:r,label:r})))}catch(e){console.error("Error fetching sectors:",e),x("Sektör bilgileri alınırken bir hata oluştu.")}finally{S(!1)}},v=e=>{g(e.map(s=>s.value))},z=async()=>{if(d.length===0){n.fire({icon:"warning",title:"Uyarı",text:"En az bir sektör seçmelisiniz."});return}try{const e=f(m,"companies",l);await q(e,{sectors:d}),n.fire({icon:"success",title:"Başarılı",text:"Sektörler başarıyla kaydedildi."}).then(()=>{window.location.href="/success"})}catch(e){n.fire({icon:"error",title:"Hata",text:"Sektörler kaydedilirken bir hata oluştu: "+e.message})}};return t.jsx("div",{className:"max-w-4xl mx-auto mb-20",children:p?t.jsx("p",{children:"Loading..."}):h?t.jsx("p",{className:"text-red-500",children:h}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-medium leading-6 text-gray-900",children:"Sektör Seç"}),t.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Firmanızın ilanlarla eşleşebilmesi için sektör seçiniz. En fazla ",t.jsx("strong",{children:"3 sektör"})," seçilebilir."]})]}),t.jsx("div",{className:"mt-6",children:t.jsxs("div",{className:"sm:col-span-4",children:[t.jsx("label",{htmlFor:"sectors",className:"block text-sm font-medium text-gray-700",children:"Sektör Seçimi"}),t.jsx(I,{isMulti:!0,name:"sectors",options:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm",classNamePrefix:"select",onChange:v,value:u.filter(e=>d.includes(e.value)),menuPortalTarget:document.body,menuPlacement:"auto",menuPosition:"fixed",maxMenuHeight:150,styles:{menuPortal:e=>({...e,zIndex:9999})}})]})}),t.jsx("div",{className:"mt-6 flex justify-end",children:t.jsx("button",{type:"button",onClick:z,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700",children:"Kaydet"})})]})})}export{O as default};
