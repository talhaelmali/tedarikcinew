import{r as o,G as X,k as Q,j as e,g as ye,l as je,B as be,u as Ne,S as m,o as we,d as A,K as ve,h as K,i as Z,f as z,O as ke,P as H,C as J,Q as Ae,T as Be}from"./index-Dcbjm_y_.js";import{d as j}from"./dayjs.min-BlpTt0Ad.js";import{r as Ce,d as Fe}from"./duration-13dM_ovc.js";import{M as ee}from"./index-dfNAwhCR.js";import{E as Se}from"./EditAdModal-DDCd-jM-.js";import{F as Ee}from"./StarIcon-BZGbSflq.js";import"./react-select.esm-Dy9iw_O8.js";function Te({title:l,titleId:i,...r},s){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":i},r),l?o.createElement("title",{id:i},l):null,o.createElement("path",{fillRule:"evenodd",d:"M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z",clipRule:"evenodd"}))}const O=o.forwardRef(Te),Ie=({bids:l,bidderRatings:i,handleAcceptBid:r,adData:s,maskCompanyName:F,handleBidClick:R})=>{var B,T;const{company:w}=X(),v=t=>{const S=Math.floor(t),I=t%1!==0,M=5-S-(I?1:0);return e.jsxs("div",{className:"flex",children:[[...Array(S)].map((U,g)=>e.jsx(O,{className:"h-5 w-5 text-yellow-500"},g)),I&&e.jsx(O,{className:"h-5 w-5 text-gray-300"},"half-star"),[...Array(M)].map((U,g)=>e.jsx(O,{className:"h-5 w-5 text-gray-300"},g))]})},c=l.length>0?l.reduce((t,N)=>N.bidAmount<t.bidAmount?N:t,l[0]):null,b=w&&(w.adminUserId===((B=Q.currentUser)==null?void 0:B.uid)||((T=w.teamMembers)==null?void 0:T.some(t=>{var N;return t.userId===((N=Q.currentUser)==null?void 0:N.uid)}))),E=w?l.filter(t=>t.bidderCompanyId===w.id):[];return e.jsxs("div",{className:"border-t border-gray-200 px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:s.adType==="Kapalı Usül Teklif"&&!b?"Gönderdiğim Teklifler":s.adType==="Kapalı Usül Teklif"?"Gelen Teklifler":"Gelen En Düşük Teklif"}),e.jsxs("div",{className:"mt-4",children:[s.adType==="Kapalı Usül Teklif"?b?l.length>0&&l.map(t=>e.jsxs("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:[e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:F(t.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[t.bidderCompanyId]?e.jsxs(e.Fragment,{children:[v(i[t.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[t.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:t.createdAt?new Date(t.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:t.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",t.bidAmount," ₺"]})})]})]}),b&&e.jsx("div",{className:"w-full md:w-[133px] text-[#2563EB] text-sm font-medium border-l-2 py-[17px] flex justify-center items-center",children:e.jsx("button",{className:"inline-flex justify-center rounded-md border border-transparent py-1 px-2 text-xs font-medium text-[#2563EB] hover:bg-gray-200",onClick:()=>r(t.id,t.bidderCompanyId,t.bidderCompanyName),disabled:s.status==="approved",children:"Teklifi Kabul Et"})})]},t.id)):E.length>0?E.map(t=>e.jsx("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:F(t.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[t.bidderCompanyId]?e.jsxs(e.Fragment,{children:[v(i[t.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[t.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:t.createdAt?new Date(t.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:t.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",t.bidAmount," ₺"]})})]})]})},t.id)):e.jsx("p",{className:"text-gray-500",children:"Henüz teklif vermediniz."}):c&&e.jsx("div",{className:"md:flex max-w-[1162px] box-shadow-md rounded-lg",children:e.jsxs("div",{className:"flex w-full gap-3 p-4",children:[e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/Subtract.png?alt=media&token=e4e4bf99-2c0e-4136-952b-2581986ccc74",alt:"profile",className:"h-12 w-max-[39px]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between mb-2 md:mb-1",children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"font-medium text-sm text-[#111827]",children:F(c.bidderCompanyName)}),e.jsx("div",{className:"flex rounded-[4px] px-[6px] py-1 ml-2 bg-[#F3F4F6]",children:i[c.bidderCompanyId]?e.jsxs(e.Fragment,{children:[v(i[c.bidderCompanyId]),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:i[c.bidderCompanyId]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),e.jsx("p",{className:"text-sm font-normal text-[#8d8d8e]",children:c.createdAt?new Date(c.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"})]}),e.jsx("p",{className:"font-normal text-sm",children:c.bidDetails||"Detay Yok"}),e.jsx("div",{className:"max-w-[149px] bg-[#D1FAE5] rounded-xl py-[2px] px-[12px] mt-2 text-center",children:e.jsxs("p",{className:"font-medium text-sm text-[#065F46]",children:["Teklifim: ",c.bidAmount," ₺"]})})]})]})},c.id),!b&&e.jsx("div",{className:"text-right mt-4",children:e.jsx("button",{onClick:R,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Teklif Ver"})})]})]})};j.extend(Ce);j.extend(Fe);ee.setAppElement("#root");const h=ye(),De=je(),He=()=>{var _;const{companyId:l,adId:i}=be(),{company:r}=X(),[s,F]=o.useState(null),[R,w]=o.useState([]),[v,c]=o.useState(null),[b,E]=o.useState({}),[B,T]=o.useState(!0),[t,N]=o.useState(null),[S,I]=o.useState(!1),[M,U]=o.useState(!1),[g,P]=o.useState(null),[se,D]=o.useState(!1),[te,q]=o.useState(!1),k=Ne();o.useEffect(()=>{r&&G()},[r,i]),o.useEffect(()=>{!B&&s&&s.endDate&&j().isAfter(j(s.endDate.seconds*1e3))&&(t==null?void 0:t.id)!==(r==null?void 0:r.id)&&m.fire({icon:"info",title:"İlan Süresi Doldu",text:"Bu ilan süresi dolduğu için artık görüntülenemiyor."}).then(()=>{k("/ads")})},[s,B,t,r,k]);const G=()=>{r!=null&&r.FollowedAds&&r.FollowedAds.includes(i)?D(!0):D(!1)};o.useEffect(()=>{const a=we(De,n=>{P(n||null)});return()=>a()},[]),o.useEffect(()=>{const a=A(h,"companies",l,"ads",i),n=ve(a,async p=>{if(!p.exists()){m.fire({icon:"error",title:"İlan Bulunamadı",text:"Görüntülemek istediğiniz ilan bulunamadı."}).then(()=>{k("/ads")});return}F(p.data()),T(!1);const d=K(h,"companies",l,"ads",i,"bids"),u=(await Z(d)).docs.map(C=>({id:C.id,...C.data()})),f={},L=await Y(l);f[l]=L;for(const C of u){const $=await Y(C.bidderCompanyId);f[C.bidderCompanyId]=$}w(u),E(f)});return(async()=>{const p=A(h,"companies",l),d=await z(p);if(!d.exists()){m.fire({icon:"error",title:"Şirket Bilgisi Bulunamadı",text:"İlana ait şirket bilgisi bulunamadı."}).then(()=>{k("/ads")});return}if(N({id:d.id,...d.data()}),g){const y=d.data().adminUserId===g.uid;I(y),U(d.data().adminUserId===g.uid||(r==null?void 0:r.id)===l)}})(),G(),()=>n()},[i,l,g]);const Y=async a=>{const n=K(h,"companies",a,"ratings"),x=await Z(n);if(x.empty)return null;{let p=0,d=0;return x.forEach(y=>{const u=y.data(),f=(u.communication+u.quality+u.speed)/3;p+=f,d++}),(p/d).toFixed(1)}},ae=()=>{!s||s.status==="approved"||s.endDate&&j().isAfter(j(s.endDate.seconds*1e3))||k(`/ad-details/${l}/${i}/bid`)},ne=async(a,n,x)=>{if((await m.fire({title:"Teklifi kabul etmek istediğinizden emin misiniz?",icon:"warning",showCancelButton:!0,confirmButtonText:"Evet, kabul et!",cancelButtonText:"Hayır, iptal et"})).isConfirmed)try{const d=A(h,"companies",l,"ads",i,"bids",a),y=A(h,"companies",l,"ads",i),u=await z(d),f=await z(y);if(!u.exists()||!f.exists())throw new Error("Teklif veya ilan verisi bulunamadı.");const L=u.data(),$={ad:{...f.data()},bid:{...L},companyId:l,bidderCompanyId:n,orderDate:new Date};await ke(K(h,"orders"),$),await H(y),await H(d),m.fire("Başarılı!","Teklif kabul edildi ve ilan kapatıldı.","success"),k("/myorders")}catch(d){m.fire("Hata!",`Teklif kabul edilirken bir hata oluştu: ${d.message}`,"error")}},le=async()=>{if((await m.fire({title:"İlanı silmek istediğinizden emin misiniz?",icon:"warning",showCancelButton:!0,confirmButtonText:"Evet, sil!",cancelButtonText:"Hayır, iptal et"})).isConfirmed)try{const n=A(h,"companies",l,"ads",i);await H(n),m.fire("Başarılı!","İlan başarıyla silindi.","success"),k("/dashboard")}catch(n){m.fire("Hata!",`İlan silinirken bir hata oluştu: ${n.message}`,"error")}},ie=async()=>{try{const a=A(h,"companies",r.id);await J(a,{FollowedAds:Ae(i)}),D(!0),m.fire({title:"Başarılı!",text:"İlan takibe alındı!",icon:"success",confirmButtonText:"Tamam"})}catch(a){console.error("Error following ad:",a),m.fire("Hata!","İlan takibe alınamadı.","error")}},re=async()=>{try{const a=A(h,"companies",r.id);await J(a,{FollowedAds:Be(i)}),D(!1),m.fire({title:"Başarılı!",text:"İlan takibi kaldırıldı!",icon:"success",confirmButtonText:"Tamam"})}catch(a){console.error("Error unfollowing ad:",a),m.fire("Hata!","İlan takibi kaldırılamadı.","error")}},de=()=>{q(!0)},oe=()=>{q(!1)},ce=a=>a?typeof a=="string"?e.jsx("img",{src:a,alt:"Ad Image",className:"h-24 w-24 object-cover cursor-pointer",onClick:()=>c(a)}):Array.isArray(a)?a.map((n,x)=>e.jsx("img",{src:n,alt:`Görsel ${x+1}`,className:"h-24 w-24 object-cover cursor-pointer",onClick:()=>c(n)},x)):null:e.jsx("p",{className:"text-sm text-gray-500",children:"Yüklenen fotoğraf yok."}),V=()=>c(null),W=a=>a.split(" ").map(n=>n.length>1?n[0]+"*".repeat(n.length-1):n).join(" ");if(B||!s)return e.jsx("div",{children:"Loading..."});const me=(a,n)=>{if(!a||!n)return null;const x=new Date(a.seconds*1e3);return x.setDate(x.getDate()+parseInt(n)),x},xe=a=>{if(!a)return"Bilinmiyor";const n=j(),p=j(a.seconds?a.seconds*1e3:a).diff(n);if(p<=0)return"Kapandı";const d=j.duration(p),y=Math.floor(d.asDays()),u=d.hours(),f=d.minutes();return`${y} gün ${u} saat ${f} dakika`},pe=a=>new Intl.NumberFormat("tr-TR",{minimumFractionDigits:0,maximumFractionDigits:2}).format(a),ue=me(s==null?void 0:s.createdAt,s==null?void 0:s.duration),fe=xe((s==null?void 0:s.endDate)||ue),he=t!=null&&t.companyName?W(t.companyName):"Bilinmeyen Şirket",ge=t!=null&&t.id?t.id.replace(/.(?=.{4})/g,"*"):"****";return e.jsxs("div",{className:"mx-auto mb-20 p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between rounded-lg px-4 py-5 sm:px-6",children:[e.jsxs("div",{className:"flex gap-5 md:gap-0 items-start flex-col md:flex-row",children:[e.jsx("img",{className:"h-10 w-10 rounded-full",src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/profilepic.svg?alt=media&token=b85d5d31-8627-48b9-9691-335d0d58329e",alt:"Profile"}),e.jsxs("div",{className:"md:ml-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[24px] leading-8 text-gray-900",children:he}),e.jsxs("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:["@",ge]})]}),e.jsx("div",{className:"flex align-top md:ml-5 px-3 py-1 bg-[#F3F4F6] mb-3",children:b[l]?e.jsxs("div",{className:"flex",children:[e.jsx(Ee,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:b[l]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Puanlanmadı"})})]}),S?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:le,className:"bg-red-500 text-white px-4 py-2 rounded-md",children:"Kaldır"}),e.jsx("button",{onClick:de,className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:"İlanı Düzenle"})]}):e.jsx("div",{className:"py-4 sm:px-6",children:se?e.jsx("button",{onClick:re,className:"bg-red-500 text-white px-4 py-2 rounded-md",children:"Bildirimleri Kapat"}):e.jsx("button",{onClick:ie,className:"bg-blue-500 text-white px-4 py-2 rounded-md",children:"Bildirim Al"})})]}),e.jsx(Se,{isOpen:te,onRequestClose:oe,adId:i,companyId:l,adData:s}),e.jsxs("div",{className:"mt-6 bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsx("div",{className:"px-4 pt-5 sm:px-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"flex flex-col md:flex-row gap-5",children:e.jsx("div",{children:(_=s==null?void 0:s.sectors)==null?void 0:_.map((a,n)=>e.jsx("span",{className:"text-xs bg-[#F3F4F6] font-medium rounded-md px-2",children:a},n))})}),e.jsxs("div",{className:"md:ml-auto flex flex-col md:flex-row mt-4 md:mt-0 gap-4",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:s.adType}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:s.createdAt?new Date(s.createdAt.seconds*1e3).toLocaleDateString():"Bilinmiyor"}),e.jsxs("span",{className:"ml-2 text-xs bg-[#FEF2F2] text-[#EF4444] px-3",children:["İlan Süresi: ",fe]})]})]})}),e.jsx("div",{className:"px-4 py-5 sm:p-0",children:e.jsxs("dl",{className:"",children:[e.jsx("div",{className:"py-2 sm:grid sm:grid-cols-3 sm:px-6",children:e.jsx("dt",{className:"text- font-medium text-[#111827] flex items-center gap-1",children:e.jsx("p",{children:(s==null?void 0:s.title)||"Başlık Bulunamadı"})})}),e.jsx("div",{className:"py-4 sm:py-2 sm:grid sm:grid-cols-1 sm:gap-4 sm:px-6",children:e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:(s==null?void 0:s.content)||"İçerik Bulunamadı"})}),e.jsx("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.jsx("div",{className:"flex flex-wrap gap-4",children:ce(s==null?void 0:s.images)})})}),e.jsx("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Talep Edilen Adet: ",s!=null&&s.quantity?pe(s.quantity):"Bilinmiyor"," ",s!=null&&s.unit?s.unit:"Bilinmiyor"]})}),e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-2 sm:gap-4 sm:px-6",children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.requestSample?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),e.jsx("p",{className:"mr-10",children:"Numune Talep Ediliyor"})]}),e.jsxs("div",{className:"font-medium justify-self-end text-xs text-black",children:["Termin Tarihi: ",s!=null&&s.dueDate?new Date(s.dueDate.seconds*1e3).toLocaleDateString():"Bilinmiyor"]})]}),e.jsx(Ie,{bids:R,bidderRatings:b,isUserAdmin:S,adData:s,maskCompanyName:W,currentUser:g,handleBidClick:ae,handleAcceptBid:ne,isUserAdminOrMember:M})]})})]}),e.jsx(ee,{isOpen:!!v,onRequestClose:V,className:"fixed inset-0 flex items-center justify-center p-4 bg-black bg-opacity-75",children:e.jsxs("div",{className:"bg-white rounded-lg p-6",style:{width:"50%",height:"50%"},children:[e.jsx("img",{src:v,alt:"Detail View",className:"max-w-full max-h-full object-contain"}),e.jsxs("div",{className:"mt-4 text-right",children:[e.jsx("a",{href:v,download:!0,className:"inline-block bg-blue-500 text-white px-4 py-2 rounded-md",children:"İndir"}),e.jsx("button",{onClick:V,className:"ml-2 inline-block bg-gray-500 text-white px-4 py-2 rounded-md",children:"Kapat"})]})]})})]})};export{He as default};
