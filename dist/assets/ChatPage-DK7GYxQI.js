import{r as a,g as G,B as J,u as K,G as L,D as U,K as Z,h as y,J as Q,j as e,f as M,d as O,i as T,O as A}from"./index-Pf0wcubd.js";import{O as V}from"./OrderDetailsModal-B-fLviB7.js";import{F as b}from"./StarIcon-Cw7Vks69.js";import"./index-eQKlA1cn.js";function W({title:o,titleId:n,...l},h){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":n},l),o?a.createElement("title",{id:n},o):null,a.createElement("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"}))}const X=a.forwardRef(W),x=G(),re=()=>{const{orderId:o,companyId1:n,companyId2:l}=J(),h=K(),{company:i}=L(),[I,E]=a.useState([]),[u,v]=a.useState(""),[j,R]=a.useState(!1),[f,$]=a.useState(null),[S,z]=a.useState(""),[p,C]=a.useState(null),[k,D]=a.useState(!1),g=`${o}_${n}_${l}`;let N="";a.useEffect(()=>{if(!i)return;(()=>{const t=i.id;if(t===n)N=l;else if(t===l)N=n;else{h("/");return}R(!0),F(N)})()},[i,h,n,l]);const F=async s=>{if(!s)return;const t=await M(O(x,"companies",s));if(t.exists()){const r=t.data();z(r.companyName),P(s)}else console.error("Company not found")},P=async s=>{const t=y(x,"companies",s,"ratings"),r=await T(t);if(r.empty)C("N/A");else{let c=0,d=0;r.forEach(w=>{const m=w.data(),Y=(m.communication+m.quality+m.speed)/3;c+=Y,d++}),C((c/d).toFixed(1))}};a.useEffect(()=>{(async()=>{const t=O(x,"orders",o),r=await M(t);r.exists()?$(r.data()):console.error("Order not found")})()},[o]),a.useEffect(()=>{if(!j)return;const s=U(y(x,"chats",g,"messages"),Z("createdAt","asc")),t=Q(s,r=>{const c=[];r.forEach(d=>{c.push({id:d.id,...d.data()})}),E(c)});return()=>t()},[g,j]);const H=async()=>{if(u.trim()==="")return;await A(y(x,"chats",g,"messages"),{chatId:g,userId:i.id,userName:i.companyName,message:u,createdAt:new Date});let s=i.id===n?l:n;const t=`Yeni bir mesaj aldınız: ${u.substring(0,20)}...`;await A(y(x,"notifications"),{companyId:s,message:t,route:`/chat/${o}/${n}/${l}`,read:!1,timestamp:new Date,type:"Mesaj"}),v("")},_=()=>{D(!0)},q=()=>{D(!1)},B=s=>{const r=Math.floor(s),c=s%1!==0,d=5-r-(c?1:0);return e.jsxs("div",{className:"flex",children:[[...Array(r)].map((w,m)=>e.jsx(b,{className:"h-5 w-5 text-yellow-500"},m)),c&&e.jsx(b,{className:"h-5 w-5 text-gray-300"},"half-star"),[...Array(d)].map((w,m)=>e.jsx(b,{className:"h-5 w-5 text-gray-300"},m))]})};return j?e.jsxs("div",{className:"flex flex-col h-full bg-white border",children:[e.jsx("div",{className:"bg-white shadow p-4 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{className:"h-10 w-10 rounded-full",src:"https://firebasestorage.googleapis.com/v0/b/ihale-6cb24.appspot.com/o/profilepic.svg?alt=media&token=b85d5d31-8627-48b9-9691-335d0d58329e",alt:"Profile"}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:S}),e.jsxs("div",{className:"flex items-center space-x-1 bg-gray-200 p-1 rounded",children:[p!=="N/A"&&e.jsxs(e.Fragment,{children:[B(p),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:p})]}),p==="N/A"&&e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Puanlanmadı"})]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",S.split(" ").map(s=>s[0]+"****").join(" ")]})]})]})}),f&&e.jsxs("div",{className:"bg-white shadow p-4 flex justify-between items-center mt-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ml-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:["Sipariş İlan Adı: ",f.ad.title]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Sipariş İçeriği: ",f.ad.content]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Sipariş ID: ",o]})]})}),e.jsx("button",{onClick:_,className:"bg-blue-600 text-white px-4 py-2 rounded-md",children:"Sipariş Detaylarını Göster"})]}),e.jsx("div",{className:"bg-white shadow p-4 text-lg font-semibold text-gray-900",children:"Mesajlaşma"}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",style:{maxHeight:"30vh",overflowY:"scroll"},children:I.map((s,t)=>e.jsxs("div",{className:`p-4 my-2 rounded-lg max-w-[45%] ${s.userId===i.id?"bg-green-100 self-end ml-auto":"bg-gray-100 self-start mr-auto"}`,children:[e.jsx("p",{children:s.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(s.createdAt.seconds*1e3).toLocaleString()})]},t))}),e.jsxs("div",{className:"bg-white p-4 shadow flex items-center rounded-full",children:[e.jsx("input",{type:"text",value:u,onChange:s=>v(s.target.value),placeholder:"Mesajınızı yazın...",className:"flex-1 p-2 border border-gray-300 rounded-full pl-4 focus:outline-none"}),e.jsx("button",{onClick:H,className:"bg-blue-600 text-white px-4 py-4 rounded-full flex items-center justify-center ml-2",children:e.jsx(X,{className:"h-5 w-5 transform"})})]}),k&&f&&e.jsx(V,{order:f,closeModal:q})]}):e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Yükleniyor..."})};export{re as default};
